# Zen Master Fine-tuning Configuration for Blackhole (P150/P300c)
#
# Optimized for Blackhole architecture (single or dual chip configs).
# - P150: Single chip (set mesh_shape to [1, 1], enable_ddp: False)
# - P300c: Dual chip (current config)
# - Higher memory bandwidth than Wormhole
# - Faster training performance

training_config:
  model_type: "llama"
  seed: 42
  batch_size: 16                   # Blackhole: Good balance for P300c
  validation_batch_size: 4
  num_epochs: 3                    # 3 epochs over ~200 examples
  max_steps: 500                   # Same total steps
  learning_rate: 0.0001            # Lower LR for fine-tuning
  weight_decay: 0.01
  use_moreh_adamw: true
  use_kahan_summation: false
  use_clip_grad_norm: true
  clip_grad_norm_max_norm: 1.0
  gradient_accumulation_steps: 2   # Effective batch: 16 * 2 = 32
  eval_every: 50                   # Validate every 50 steps
  model_save_interval: 100         # Checkpoint every 100 steps
  tokenizer_type: "bpe"
  checkpoint_dir: "checkpoints_zen_blackhole"
  model_config: "model_configs/tinyllama.yaml"

scheduler_config:
  max_lr: 1e-4                     # Peak learning rate
  min_lr: 1e-5                     # Minimum LR at end
  warmup_steps: 50                 # 10% warmup
  hold_steps: 350                  # Hold at peak for most of training

eval_config:
  repetition_penalty: 1.0
  temperature: 0.0                 # Greedy decoding for validation
  top_k: 50
  top_p: 1.0

device_config:
  enable_ddp: True                 # P300c: Enable DDP for dual chips
  mesh_shape: [1, 2]               # 1x2 mesh (2 devices in parallel)
                                   # For P150 (single chip): set to [1, 1] and enable_ddp: False
